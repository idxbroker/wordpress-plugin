document.addEventListener("DOMContentLoaded",function(event){function el(e){return document.querySelectorAll(e)}function forEach(e,t,o){for(var i=0;i<e.length;i++)t.call(o,e[i],i)}function openShortcodeModal(e){e.preventDefault(),modal.style.display="block",overlay.style.display="block",el("body")[0].style.overflow="hidden",el("#wpbody")[0].style.zIndex="160000",editTab.style.display="none",insertButton.setAttribute("disabled","disabled"),previewTabButton.addEventListener("click",openPreviewTab),editTabButton.addEventListener("click",openEditTab)}function closeShortcodeModal(e){e.preventDefault(),modal.style.display="none",overlay.style.display="none",el("body")[0].style.overflow="initial",el("#wpbody")[0].style.zIndex="initial",overView.style.display="block",editTab.innerHTML="",tabButtons.style.display="none",previewTab.style.display="none",previewTabButton.classList.remove("idx-active-tab"),editTabButton.classList.add("idx-active-tab"),modalTitle.innerHTML="Insert IDX Shortcode",previewTabButton.removeEventListener("click",openPreviewTab),editTabButton.removeEventListener("click",openEditTab)}function initializeModal(){el("#idx-shortcode")[0].addEventListener("click",openShortcodeModal),overlay.addEventListener("click",closeShortcodeModal),close.addEventListener("click",closeShortcodeModal),makeTypesSelectable(),insertButton.addEventListener("click",insertShortcode)}function makeTypesSelectable(){forEach(el(".idx-shortcode-type"),function(e,t){e.addEventListener("click",getShortcodeData)})}function getShortcodeData(e){var t=e.target.nodeName;return"I"===t?shortcodeType=e.target.parentNode.parentNode.getAttribute("data-short-name"):shortcodeType=e.target.parentNode.getAttribute("data-short-name"),overView.style.display="none",editTab.style.display="block",editTab.innerHTML='<div class="idx-loader"></div>',jQuery.post(ajaxurl,{action:"idx_shortcode_options",idx_shortcode_type:shortcodeType}).done(function(e){editTab.innerHTML=e;var t=editTab.querySelector("select");jQuery(t).select2(),insertButton.removeAttribute("disabled"),shortcodeDetailTitle(shortcodeType),updateTitle(),jQuery(t).on("change",updateTitle),tabButtons.style.display="inline-block";var o=editTab.querySelectorAll("script");evalScripts(o)}).fail(function(t){getShortcodeData(e)})}function shortcodeDetailTitle(e){"system_links"===e?modalTitle.innerHTML="IDX Shortcode Details - System Links":"saved_links"===e?modalTitle.innerHTML="IDX Shortcode Details - Saved Links":"widgets"===e?modalTitle.innerHTML="IDX Shortcode Details - Widgets":"omnibar"===e?modalTitle.innerHTML="IDX Shortcode Preview - Omnibar":"omnibar_extra"===e?modalTitle.innerHTML="IDX Shortcode Preview - Omnibar With Extra Fields":jQuery.post(ajaxurl,{action:"idx_shortcode_title",idx_shortcode_type:e}).done(function(e){modalTitle.innerHTML=e}).fail(function(t){modalTitle.innerHTML="Shortcode Details - "+e})}function openPreviewTab(e,t){e.preventDefault();var o=formShortcode(),i=el(".idx-modal-shortcode-field"),a=i[0].getAttribute("data-shortcode");editTab.style.display="none",previewTab.style.display="block",previewTab.innerHTML='<div class="idx-loader"></div>',editTabButton.classList.remove("idx-active-tab"),previewTabButton.classList.add("idx-active-tab"),t!==!1&&jQuery.post(ajaxurl,{action:"idx_shortcode_preview",idx_shortcode:o}).done(function(e){el(".idx-modal-tabs a:nth-of-type(2)")[0].classList.add("idx-active-tab"),previewTab.innerHTML=e;var t=previewTab.querySelectorAll("script");return evalScripts(t)}).fail(function(t){openEditTab(e)})}function evalScripts(scripts){"undefined"!=typeof scripts[0]&&forEach(scripts,function(value){var src=value.getAttribute("src");return null!==src?jQuery.getScript(src):void eval(value.innerHTML)})}function openEditTab(e){e.preventDefault(),previewTab.style.display="none",editTab.style.display="block",previewTabButton.classList.remove("idx-active-tab"),editTabButton.classList.add("idx-active-tab")}function formShortcode(){var e=el(".idx-modal-shortcode-field"),t=e[0].getAttribute("data-shortcode");fieldList=getFieldNames(e),extraParameters=formExtraParameters(fieldList);var o="["+t+extraParameters+"]";return o}function getFieldNames(e){var t=[];return forEach(e,function(e){var o=getInput(e),i={};return o?(i.name=o.getAttribute("data-short-name"),i.value=o.value,"title"===i.name&&(i.value=formTitle(i.value)),void t.push(i)):""}),t}function formTitle(e){if("undefined"!=typeof e&&""!==e)return e;var t=el("#idx-select-subtype option")[0];return"undefined"!=typeof t?title=findSelected("#idx-select-subtype option").innerHTML:title="",title}function getInput(e){var t=e.querySelectorAll("input")[0],o=e.querySelectorAll("select")[0];return"undefined"!=typeof t?t:"undefined"!=typeof o?o:!1}function formExtraParameters(e){if(""===e)return"";var t=" ";return forEach(e,function(e){t+=e.name+'="'+e.value+'" '}),t}function updateTitle(){var e=el(".idx-modal-shortcode-edit #title")[0];"undefined"!=typeof e&&(e.value=findSelected("#idx-select-subtype option").innerHTML)}function findSelected(e){var t=!1;return forEach(el(e),function(e){return e.selected?t=e:void 0}),t}function insertShortcode(e){e.preventDefault(),shortcode=formShortcode(),send_to_editor(shortcode),closeShortcodeModal(e)}var modal=el("#idx-shortcode-modal")[0],close=modal.querySelector(".media-modal-close"),overlay=el("#idx-overlay")[0],innerContent=el(".idx-modal-inner-content")[0],overView=el(".idx-modal-inner-overview")[0],editTab=el(".idx-modal-shortcode-edit")[0],insertButton=el(".idx-toolbar-primary button")[0],modalTitle=el("#idx-shortcode-modal h1")[0],previewTab=el(".idx-modal-shortcode-preview")[0],editTabButton=el(".idx-modal-tabs a:nth-of-type(1)")[0],previewTabButton=el(".idx-modal-tabs a:nth-of-type(2)")[0],tabButtons=el(".idx-modal-tabs-router")[0];initializeModal()});