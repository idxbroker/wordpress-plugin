document.addEventListener("DOMContentLoaded",function(event){function el(e){return document.querySelectorAll(e)}function forEach(e,t,i){for(var o=0;o<e.length;o++)t.call(i,e[o],o)}function openShortcodeModal(e){e.preventDefault(),modal.style.display="block",overlay.style.display="block",el("body")[0].style.overflow="hidden",el("#wpbody")[0].style.zIndex="160000",editTab.style.display="none",insertButton.setAttribute("disabled","disabled"),previewTabButton.addEventListener("click",openPreviewTab),editTabButton.addEventListener("click",openEditTab),backButton.addEventListener("click",backToOverview),el(".idx-back-button")[0].style.display="none"}function closeShortcodeModal(e){e.target!==modal&&e.target!==close&&e.target!==close.querySelector("span")&&e.target!==insertButton||(e.preventDefault(),modal.style.display="none",overlay.style.display="none",el("body")[0].style.overflow="initial",el("#wpbody")[0].style.zIndex="initial",overView.style.display="block",editTab.innerHTML="",tabButtons.style.display="none",previewTab.style.display="none",previewTabButton.classList.remove("idx-active-tab"),editTabButton.classList.add("idx-active-tab"),modalTitle.innerHTML="Insert IDX Shortcode",previewTabButton.removeEventListener("click",openPreviewTab),editTabButton.removeEventListener("click",openEditTab),backButton.removeEventListener("click",backToOverview))}function backToOverview(e){e.preventDefault(),overView.style.display="block",editTab.innerHTML="",tabButtons.style.display="none",previewTab.style.display="none",editTab.style.display="none",insertButton.setAttribute("disabled","disabled"),previewTabButton.classList.remove("idx-active-tab"),editTabButton.classList.add("idx-active-tab"),modalTitle.innerHTML="Insert IDX Shortcode",el(".idx-back-button")[0].style.display="none"}function initializeModal(){el("#idx-shortcode")[0].addEventListener("click",openShortcodeModal),modal.addEventListener("click",function(e){closeShortcodeModal(e)}),close.addEventListener("click",closeShortcodeModal),makeTypesSelectable(),insertButton.addEventListener("click",insertShortcode)}function makeTypesSelectable(){forEach(el(".idx-shortcode-type"),function(e,t){e.addEventListener("click",getShortcodeData)})}function getShortcodeData(e){var t=e.target.nodeName;return"I"===t?shortcodeType=e.target.parentNode.parentNode.getAttribute("data-short-name"):shortcodeType=e.target.parentNode.getAttribute("data-short-name"),overView.style.display="none",editTab.style.display="block",el(".idx-back-button")[0].style.display="block",editTab.innerHTML='<div class="idx-loader"></div>',jQuery.post(ajaxurl,{action:"idx_shortcode_options",idx_shortcode_type:shortcodeType,nonce:IDXShortcodeOptionsNonce}).done(function(e){editTab.innerHTML=e;var t=editTab.querySelector("select");jQuery(t).select2(),insertButton.removeAttribute("disabled"),shortcodeDetailTitle(shortcodeType),updateTitle(),jQuery(t).on("change",updateTitle),tabButtons.style.display="inline-block";var i=editTab.querySelectorAll("script");evalScripts(i)}).fail(function(t){getShortcodeData(e)})}function shortcodeDetailTitle(e){switch(e){case"system_links":modalTitle.innerHTML="Shortcode Details - System Links";break;case"saved_links":modalTitle.innerHTML="Shortcode Details - Saved Links";break;case"widgets":modalTitle.innerHTML="Shortcode Details - Widgets";break;case"omnibar":modalTitle.innerHTML="Shortcode Details - IMPress Omnibar";break;case"impress_lead_login":modalTitle.innerHTML="Shortcode Details - IMPress Lead Login";break;case"impress_lead_signup":modalTitle.innerHTML="Shortcode Details - IMPress Lead Signup";break;case"impress_city_links":modalTitle.innerHTML="Shortcode Details - IMPress City Links";break;case"impress_property_showcase":modalTitle.innerHTML="Shortcode Details - IMPress Property Showcase";break;case"impress_property_carousel":modalTitle.innerHTML="Shortcode Details - IMPress Property Carousel";break;case"idx_wrapper_tags":modalTitle.innerHTML="Shortcode Details - IDX Wrapper Tags";break;default:jQuery.post(ajaxurl,{action:"idx_shortcode_title",idx_shortcode_type:e}).done(function(e){modalTitle.innerHTML=e}).fail(function(t){modalTitle.innerHTML="Shortcode Details - "+e})}}function openPreviewTab(e,t){e.preventDefault();var i=formShortcode(),o=el(".idx-modal-shortcode-field");o[0].getAttribute("data-shortcode");editTab.style.display="none",previewTab.style.display="block",previewTab.innerHTML='<div class="idx-loader"></div>',editTabButton.classList.remove("idx-active-tab"),previewTabButton.classList.add("idx-active-tab"),t!==!1&&jQuery.post(ajaxurl,{action:"idx_shortcode_preview",idx_shortcode:i,nonce:IDXShortcodePreviewNonce}).done(function(e){previewScriptsLoaded=!1,previewTab.querySelector(".idx-loader").style.display="none",el(".idx-modal-tabs a:nth-of-type(2)")[0].classList.add("idx-active-tab"),loadIframe(e);var t=previewTab.querySelector("iframe");evalPreviewScripts(editTab.querySelectorAll("script"),t.contentWindow.document.body)}).fail(function(t){openEditTab(e)})}function loadIframe(e){var t=document.createElement("iframe");t.style.width="100%",t.style.minHeight="100%",t.onload=function(){t.contentWindow.document.body.innerHTML='<div class="idx-modal-shortcode-preview">'+e+"</div>",addStyleSheets(styleSheetUrls,t.contentWindow.document.body)},previewTab.appendChild(t)}function evalPreviewScripts(e,t){function i(a){var r=a.getAttribute("src"),n=a.getAttribute("data-dynamic");if(o++,null!==n)return e[o]?i(e[o]):loadPreviewScripts();if(null!==r){var d=document.createElement("script");return d.src=r,d.setAttribute("data-dynamic",!0),e[o]?d.onload=function(){i(e[o])}:d.onload=function(){loadPreviewScripts()},t.appendChild(d)}var l=previewTab.querySelector("iframe");return l.contentWindow.eval(a.innerHTML),e[o]?void i(e[o]):loadPreviewScripts()}if("undefined"==typeof e[0])return loadPreviewScripts();var o=0;i(e[o])}function evalScripts(scripts){"undefined"!==scripts[0]&&forEach(scripts,function(value){eval(value.innerHTML)})}function loadPreviewScripts(){if(!previewScriptsLoaded){previewScriptsLoaded=!0;var e=previewTab.querySelector("iframe");evalPreviewScripts(e.contentWindow.document.querySelectorAll("script"),e.contentWindow.document.body)}}function addStyleSheets(e,t){var i=document.querySelectorAll(".idx-modal-shortcode-edit #styles")[0];"undefined"!=typeof i&&i.checked&&forEach(e,function(e){addStyleSheet(e,t)})}function addStyleSheet(e,t){var i=document.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",e),"undefined"!=typeof removable&&i.setAttribute("class","preview-css"),t.appendChild(i)}function openEditTab(e){e.preventDefault(),previewTab.style.display="none",editTab.style.display="block",previewTabButton.classList.remove("idx-active-tab"),editTabButton.classList.add("idx-active-tab")}function formShortcode(){var e=el(".idx-modal-shortcode-field"),t=e[0].getAttribute("data-shortcode");fieldList=getFieldNames(e),extraParameters=formExtraParameters(fieldList);var i="["+t+extraParameters+"]";return i}function getFieldNames(e){var t=[];return forEach(e,function(e){var i=getInput(e),o={};return i?(o.name=i.getAttribute("data-short-name"),o.value=i.value,"title"===o.name&&(o.value=formTitle(o.value)),void t.push(o)):""}),t}function formTitle(e){if("undefined"!=typeof e&&""!==e)return e;var t=el("#idx-select-subtype option")[0];return"undefined"!=typeof t?title=findSelected("#idx-select-subtype option").innerHTML:title="",title}function getInput(e){var t=e.querySelectorAll("input")[0],i=e.querySelectorAll("select")[0],o=e.querySelectorAll("textarea")[0],a=e.querySelectorAll("input[type=checkbox]")[0];return"undefined"!=typeof a?(a.checked?a.value=1:a.value=0,a):"undefined"!=typeof t?t:"undefined"!=typeof i?i:"undefined"!=typeof o&&o}function formExtraParameters(e){if(""===e)return"";var t=" ";return forEach(e,function(e){t+=e.name+'="'+e.value+'" '}),t}function updateTitle(){var e=el(".idx-modal-shortcode-edit #title")[0];"undefined"!=typeof e&&(e.value=findSelected("#idx-select-subtype option").innerHTML)}function findSelected(e){var t=!1;return forEach(el(e),function(e){if(e.selected)return t=e}),t}function insertShortcode(e){e.preventDefault(),shortcode=formShortcode(),send_to_editor(shortcode),closeShortcodeModal(e)}if("undefined"!=typeof el("#idx-shortcode")[0]){var modal=el("#idx-shortcode-modal")[0],close=modal.querySelector(".media-modal-close"),overlay=el("#idx-overlay")[0],innerContent=el(".idx-modal-inner-content")[0],overView=el(".idx-modal-inner-overview")[0],editTab=el(".idx-modal-shortcode-edit")[0],insertButton=el(".idx-toolbar-primary button")[0],modalTitle=el("#idx-shortcode-modal h1")[0],backButton=el(".idx-back-button a")[0],previewTab=el(".idx-modal-shortcode-preview")[0],editTabButton=el(".idx-modal-tabs a:nth-of-type(1)")[0],previewTabButton=el(".idx-modal-tabs a:nth-of-type(2)")[0],tabButtons=el(".idx-modal-tabs-router")[0],styleSheetUrls=[],previewScriptsLoaded=!1;initializeModal()}});